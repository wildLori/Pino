<!doctype html>
<html>

<head>
    <title>Node Authentication</title>
    <link rel="stylesheet" href="/stylesheets/boot.css">
    <link rel="stylesheet" href="/stylesheets/login.css">

</head>

<body>
    <div class="text-center">

        <h1><span class="fa fa-sign-in"></span>Bentornato ðŸ‘‹</h1>

        <!-- LOGIN FORM -->
        <form id="myForm">
            <div class="form-signin">
                <input id="txt_username" type="text" class="form-control" placeholder="Username" name="username">
                <p></p>
                <input id="txt_pin" type="password" class="form-control" placeholder="PIN" name="pin">
                <button id="btn_login" class="btn btn-lg btn-primary btn-block">Login</button>
            </div>
            <button id="changeAdmin" onclick="alert(localStorage.getItem('jwt'))"
                class="btn btn-lg btn-secondary btn-block">Entra âž¡</button>

        </form>
        <hr>
    </div>
</body>

</html>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    $(document).ready(function () { // Wait until document is fully parsed
        $("#myForm").on('submit', function (e) {
            e.preventDefault();
            var getUsername = $('#txt_username').val();
            var getPIN = $('#txt_pin').val();
            makeRequest(getUsername, getPIN);

        });
    })

    function makeRequest(username, pin) {
        var form = new FormData();
        form.append("username", username);
        form.append("pin", pin);

        var settings_LOGIN = {
            "url": "https://belfanti.ddns.net:8443/auth/login",
            "method": "POST",
            "timeout": 0,
            "processData": false,
            "mimeType": "multipart/form-data",
            "contentType": false,
            "data": form
        };

        var settings_OFFICINA = {
            "url": "https://belfanti.ddns.net:8443/officina",
            "method": "GET",
            "timeout": 0,
            "xhrFields": {
                "withCredentials": true
            }
        };

        $.ajax(settings_LOGIN).done(function (response) {
            var json_data = response
            location.href = "https://belfanti.ddns.net:8443/officina"
            if (json_data.error) {
                alert("Errore! " + json_data.error)
            } else {

            }


        });
    }
</script>