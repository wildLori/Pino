<!DOCTYPE html>
<html>

<head>
  <title>Login!</title>
  <link rel="stylesheet" href="/stylesheets/boot.css">
  <link rel="stylesheet" href="/stylesheets/login.css">
</head>

<body class="text-center">
  <form class="form-signin">
    <img class="mb-4" src="https://getbootstrap.com/docs/4.0/assets/brand/bootstrap-solid.svg" alt="" width="72"
      height="72">
    <h1 class="h3 mb-3 font-weight-normal">Bentornato ðŸ‘‹</h1>
    <label for="inputUsername" class="sr-only">Username</label>
    <input type="username" id="inputUsername" class="form-control" placeholder="Username" required="" autofocus="">
    <label for="inputPin" class="sr-only">PIN</label>
    <input type="password" id="inputPIN" class="form-control" placeholder="PIN" required="">
    <button class="btn btn-lg btn-primary btn-block" type="submit" onclick="login()">Login</button>
  </form>
</body>

</html>

<script>
  async function login() {

    let username = await document.getElementById("inputUsername").value;
    let pin = await document.getElementById("inputPIN").value;

    console.log("Cosa ho ottenuto ???" + username + pin);

    try {
      var formdata = new FormData();
      formdata.append("username", username);
      formdata.append("pin", pin);

      var requestOptions = {
        method: 'POST',
        body: formdata,
        redirect: 'follow'
      };

      fetch("https://belfanti.ddns.net:8443/auth/login", requestOptions)
        .then(response => response.text())
        .then(result => alert(result))
        .catch(error => console.log('error', error));
    } catch (error) {
      console.log(error)
    }
    /*
        fetch("/auth/login", {
          method: 'POST',
          body: JSON.stringify({
            username: username,
            pin: pin
          }),
          credentials: 'include',
        }).then(function (response) {
          return response.json();
        }).then(function (result) {
          console.log(result);
          if (result.auth === true) {
            let jwt = result.accessToken;
            // set token in cookie
            localStorage.setItem('jwt', jwt);
            fetch(url, {
              headers: {
                'Authorization': 'Bearer ' + localStorage.getItem('jwt')
              },
              method: 'GET',
              cache: false
            }).then(function (response, err) {
              // Receive API response
              console.log(response, err)
              var res = err || response
            })
          }
        })*/
  }
</script>